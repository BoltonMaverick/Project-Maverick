resource_types:
- name: terraform
  type: docker-image
  source:
    repository: ljfranklin/terraform-resource
    tag: latest

resources:  
  - name: project-maverick
    type: git
    source:
      uri: https://github.com/BoltonMaverick/Project-Maverick.git
      branch: main  
      version: 2.4
        
  - name: infrastructure 
    type: terraform
    source:
      path: 
      env_name: dev
      backend_type: s3
      backend_config:
        bucket: project-marverick
        key: marverick/terraform.tfstate
        region: eu-west-2
        access_key: {{access_key}}
        secret_key: {{secret_key}}
      vars:
        tag_name: concourse
      env:
        AWS_ACCESS_KEY_ID: {{secret_key}}
        AWS_SECRET_ACCESS_KEY: {{access_key}}

jobs:
  - name: deploy
    plan:
    - get: project-maverick
      trigger: true
    - put: infrastructure
      params:
        plan: true
        destroy: false
    - put: infrastructure
      params:
        apply: true

      task: |
            export 
